---
title: "Coffee ratings"
author: "Julia MÃ¼ller"
date: "08 06 2021"
output: html_document
---

Welcome!

Data source: https://github.com/rfordatascience/tidytuesday/blob/2e9bd5a67e09b14d01f616b00f7f7e0931515d24/data/2020/2020-07-07/readme.md

Let's read in the data and get a first impression! The Tidy Tuesday site includes a link to read in the data and information on the variables. 


# Reading in the data, loading packages

```{r}
coffee <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-07/coffee_ratings.csv')

library(tidyverse)
```


# Exploring the data

```{r}
summary(coffee)

names(coffee)

str(coffee)

head(coffee)

skimr::skim(coffee)

coffee$altitude
```

Checklist
- What does each row contain?
  
- Are the data types correct?

- Messy or tidy data? Which variables, if any, are untidy?

Refer back to the codebook on github!

First impressions?


# Fixing data types

Convert species and country of origin from character to factor variables

```{r}
coffee %>% 
  mutate(species = as_factor(species),
         country_of_origin = as_factor(country_of_origin))

coffee <- coffee %>% 
  mutate(across(c(country_of_origin, species), as_factor))

str(coffee)
```


# Plots

## Cup points by altitude

Does coffee grown in higher/lower regions taste better?

Cup points by altitude
Scatterplot (geom_point)
x-axis: altitude_mean_meters
y-axis: total_cup_points

```{r}
coffee %>% 
  filter(altitude_mean_meters < 5000 & total_cup_points > 50) %>% 
  ggplot() +
  aes(x = altitude_mean_meters, y = total_cup_points,
      colour = species) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(x = "average altitude in metres",
       y = "total cup points",
       title = "Total cup points by altitude and coffee species",
       subtitle = 'I <3 coffee',
       caption = "Data source: Tidy Tuesday")
```

## Cup points by country

```{r}
coffee %>% 
  filter(altitude_mean_meters < 5000 & total_cup_points > 50) %>% 
  ggplot() +
  aes(x = altitude_mean_meters, y = total_cup_points,
      colour = country_of_origin) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(x = "average altitude in metres",
       y = "total cup points",
       title = "Total cup points by altitude and country of origin",
       subtitle = 'I <3 coffee',
       caption = "Data source: Tidy Tuesday")
```


```{r}
summary(coffee$country_of_origin)

coffee %>% 
  count(country_of_origin) %>% 
  arrange(desc(n))
```

```{r}
coffee %>% 
  filter(country_of_origin %in% c("Mexico", "Colombia", "Guatemala", "Brazil")) %>% 
  filter(altitude_mean_meters < 5000 & total_cup_points > 50) %>% 
  ggplot() +
  aes(x = altitude_mean_meters, y = total_cup_points,
      colour = country_of_origin) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(x = "average altitude in metres",
       y = "total cup points",
       title = "Total cup points by altitude and country of origin",
       subtitle = 'I <3 coffee',
       caption = "Data source: Tidy Tuesday",
       colour = "country of origin")
```


```{r}
coffee %>% 
  add_count(country_of_origin, name = "country_n") %>% 
  filter(country_n > 100 & altitude_mean_meters < 5000 & total_cup_points > 50) %>% 
  ggplot() +
  aes(x = altitude_mean_meters, y = total_cup_points,
      colour = country_of_origin) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(x = "average altitude in metres",
       y = "total cup points",
       title = "Total cup points by altitude and country of origin",
       subtitle = 'I <3 coffee',
       caption = "Data source: Tidy Tuesday",
       colour = "country of origin") 

coffee %>% 
  add_count(country_of_origin, name = "country_n") %>% 
  select(country_of_origin, country_n) %>% 
  distinct()
```


## Histograms/density plots

```{r}
coffee %>% 
  ggplot() +
  aes(x = aroma, colour = species, fill = species) +
  geom_density(alpha = 0.3) +
  theme_light() +
  labs(title = "Aroma by coffee species") +
  scale_fill_manual(values = c("seagreen", "steelblue")) +
  scale_colour_manual(values = c("seagreen", "steelblue"))
```

## Boxplot

```{r}
ggplot(coffee) +
  aes(x = species, y = sweetness,
      colour = species) +
  geom_violin() +
  geom_boxplot(width = 0.3) +
  geom_jitter(alpha = 0.4) +
  theme_light() +
  theme(legend.position = "bottom")
```



